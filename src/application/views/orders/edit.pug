extends ../layout

block content
  h1.mb-4 Editar Orden ##{order.id}
  
  form#editOrderForm
    input(type="hidden" name="id" value=order.id)
    .mb-3
      label.form-label(for="status") Estado:
      select#status.form-select(name="status")
        each status in ['pending', 'completed', 'cancelled']
          option(value=status selected=order.status === status)= status.charAt(0).toUpperCase() + status.slice(1)
    
    .mb-3
      label.form-label Usuario:
      input.form-control(type="text" value=userName readonly)
    
    h3.mt-4 Productos:
    each product in order.products
      .card.mb-3
        .card-body
          h5.card-title= product.name
          p.card-text Cantidad: #{product.quantity}
          p.card-text Precio: $#{product.price.toFixed(2)}
    
    .mb-3
      label.form-label(for="totalAmount") Total:
      input#totalAmount.form-control(type="number" name="totalAmount" value=order.totalAmount step="0.01" required)
    
    button.btn.btn-primary(type="submit") Actualizar Orden

  script.
    document.getElementById('editOrderForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const response = await fetch(`/api/order/${formData.get('id')}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(Object.fromEntries(formData))
      });
      if (response.ok) {
        alert('Orden actualizada exitosamente');
        window.location.href = '/orders';
      } else {
        alert('Error al actualizar la orden');
      }
    });
