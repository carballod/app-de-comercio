extends ../layout

block content
  h1.mb-4 #{isAdmin ? 'Todas las Órdenes' : 'Mis Órdenes'}

  if orders.length === 0
    p No hay órdenes para mostrar.
  else
    .row
      each order in orders
        .col-md-6.mb-4
          .card
            .card-body
              h5.card-title Orden ##{order.id}
              if isAdmin
                p.card-text
                  strong Usuario: 
                  | #{order.userName || 'Desconocido'}
              p.card-text
                strong Estado: 
                span(class=`badge bg-${order.status === 'completed' ? 'success' : order.status === 'cancelled' ? 'danger' : 'warning'}`)= order.status
              p.card-text
                strong Fecha: 
                | #{new Date(order.date).toLocaleString()}
              p.card-text
                strong Total: 
                | $#{order.totalAmount.toFixed(2)}
              h6.mt-3 Productos:
              ul.list-group.list-group-flush
                each product in order.products
                  li.list-group-item
                    h6= product.name
                    if product.description
                      p= product.description
                    p Cantidad: #{product.quantity} - Precio: $#{product.price.toFixed(2)}
              
              if order.status === 'pending' && !isAdmin
                button.btn.btn-sm.btn-danger.mt-3(onclick=`cancelOrder('${order.id}')`) Cancelar Orden

  script.
    async function cancelOrder(orderId) {
      if (confirm('¿Estás seguro de que quieres cancelar esta orden?')) {
        try {
          const response = await fetch(`/api/order/${orderId}/cancel`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
          });
          if (response.ok) {
            alert('Orden cancelada exitosamente');
            location.reload();
          } else {
            alert('Error al cancelar la orden');
          }
        } catch (error) {
          console.error('Error:', error);
          alert('Error al cancelar la orden');
        }
      }
    }
